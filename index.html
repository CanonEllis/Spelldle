<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spelldle - MTG Wordle</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      min-height: 100vh;
      background-color: #1a1520;
      background-image:
        radial-gradient(ellipse at 50% 0%, rgba(75, 50, 100, 0.4) 0%, transparent 60%),
        radial-gradient(ellipse at 80% 80%, rgba(50, 40, 80, 0.3) 0%, transparent 50%);
      color: #E8E4D9;
      font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, serif;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes cardReveal {
      0% { 
        opacity: 0; 
        transform: rotateY(90deg) scale(0.8);
      }
      50% {
        opacity: 1;
        transform: rotateY(-10deg) scale(1.02);
      }
      100% { 
        opacity: 1; 
        transform: rotateY(0deg) scale(1);
      }
    }
    input::placeholder {
      color: rgba(232, 228, 217, 0.4);
    }
    .loading-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      gap: 20px;
    }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(180, 150, 100, 0.2);
      border-top-color: #B4966E;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .error-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      gap: 20px;
      padding: 20px;
      text-align: center;
    }
    .error-screen h2 {
      color: #D32029;
    }
    .error-screen code {
      background: rgba(40, 35, 50, 0.8);
      padding: 20px;
      border-radius: 8px;
      max-width: 600px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <!-- 
    CONFIGURATION
    =============
    Set the path to your card pool JSON file here.
    The file should be an array of card objects with these fields:
    - name (string)
    - colors (array of "W", "U", "B", "R", "G")
    - cmc (number)
    - type (string: "Creature", "Instant", "Sorcery", etc.)
    - rarity (string: "common", "uncommon", "rare", "mythic")
    - year (number)
    - power (number or null)
    - toughness (number or null)
  -->
  <script>
    // Change this to point to your card pool JSON file
    window.CARD_POOL_URL = 'card-pool.json';
    
    // Or set cards directly (comment out CARD_POOL_URL if using this)
    // window.CARD_POOL = [...];
  </script>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    const MANA_COLORS = {
      W: { name: "White", bg: "#F8F6D8", text: "#333" },
      U: { name: "Blue", bg: "#0E68AB", text: "#fff" },
      B: { name: "Black", bg: "#2B2B2B", text: "#fff" },
      R: { name: "Red", bg: "#D32029", text: "#fff" },
      G: { name: "Green", bg: "#00733E", text: "#fff" },
    };

    const ManaSymbol = ({ color, size = 20 }) => {
      const colorData = MANA_COLORS[color];
      return (
        <span style={{
          display: 'inline-flex',
          alignItems: 'center',
          justifyContent: 'center',
          width: size,
          height: size,
          borderRadius: '50%',
          backgroundColor: colorData.bg,
          color: colorData.text,
          fontSize: size * 0.6,
          fontWeight: 'bold',
          border: '1px solid rgba(0,0,0,0.3)',
          boxShadow: 'inset 0 1px 2px rgba(255,255,255,0.3)',
        }}>
          {color}
        </span>
      );
    };

    const CompareIndicator = ({ result, children }) => {
      const colors = {
        correct: { bg: '#2D5A27', border: '#4A9C3D' },
        partial: { bg: '#8B6914', border: '#D4A82B' },
        wrong: { bg: '#4A2C2C', border: '#6B3D3D' },
        higher: { bg: '#4A2C2C', border: '#6B3D3D' },
        lower: { bg: '#4A2C2C', border: '#6B3D3D' },
      };
      
      const style = colors[result] || colors.wrong;
      const arrow = result === 'higher' ? '↑' : result === 'lower' ? '↓' : '';
      
      return (
        <div style={{
          padding: '8px 12px',
          backgroundColor: style.bg,
          border: `2px solid ${style.border}`,
          borderRadius: '6px',
          textAlign: 'center',
          minWidth: '60px',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          gap: '4px',
        }}>
          {children}
          {arrow && <span style={{ fontSize: '14px' }}>{arrow}</span>}
        </div>
      );
    };

    const getDailyCard = (cardPool) => {
      const today = new Date();
      const seed = today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
      const index = seed % cardPool.length;
      return cardPool[index];
    };

    const compareColors = (guess, target) => {
      if (guess.length === 0 && target.length === 0) return 'correct';
      if (guess.length === 0 || target.length === 0) return 'wrong';
      
      const guessSet = new Set(guess);
      const targetSet = new Set(target);
      
      const allMatch = guess.length === target.length && guess.every(c => targetSet.has(c));
      if (allMatch) return 'correct';
      
      const someMatch = guess.some(c => targetSet.has(c));
      if (someMatch) return 'partial';
      
      return 'wrong';
    };

    const compareValue = (guess, target) => {
      if (guess === target) return 'correct';
      if (guess === null || target === null) return 'wrong';
      return guess < target ? 'higher' : 'lower';
    };

    // Loading Screen Component
    function LoadingScreen() {
      return (
        <div className="loading-screen">
          <div className="loading-spinner"></div>
          <div style={{ color: '#B4966E' }}>Loading card pool...</div>
        </div>
      );
    }

    // Error Screen Component
    function ErrorScreen({ error }) {
      return (
        <div className="error-screen">
          <h2>Failed to load card pool</h2>
          <p>Make sure your card-pool.json file exists and is valid JSON.</p>
          <code>{error}</code>
          <p style={{ marginTop: '20px', opacity: 0.7 }}>
            Generate a card pool using: <br/>
            <code style={{ display: 'inline', padding: '4px 8px' }}>
              node scryfall-bulk-download.js --popular 500
            </code>
          </p>
        </div>
      );
    }

    // Main Game Component
    function Game({ cardPool }) {
      const [guesses, setGuesses] = useState([]);
      const [input, setInput] = useState('');
      const [suggestions, setSuggestions] = useState([]);
      const [gameOver, setGameOver] = useState(false);
      const [won, setWon] = useState(false);
      const [showHint, setShowHint] = useState(false);
      
      const targetCard = useMemo(() => getDailyCard(cardPool), [cardPool]);
      
      const handleInputChange = (value) => {
        setInput(value);
        if (value.length > 0) {
          const filtered = cardPool.filter(card => 
            card.name.toLowerCase().includes(value.toLowerCase()) &&
            !guesses.some(g => g.name === card.name)
          ).slice(0, 5);
          setSuggestions(filtered);
        } else {
          setSuggestions([]);
        }
      };
      
      const submitGuess = (card) => {
        if (gameOver) return;
        
        const newGuesses = [...guesses, card];
        setGuesses(newGuesses);
        setInput('');
        setSuggestions([]);
        
        if (card.name === targetCard.name) {
          setGameOver(true);
          setWon(true);
        } else if (newGuesses.length >= 6) {
          setGameOver(true);
        }
      };
      
      const formatColors = (colors) => {
        if (colors.length === 0) return <span style={{ opacity: 0.6 }}>Colorless</span>;
        return (
          <div style={{ display: 'flex', gap: '4px', justifyContent: 'center' }}>
            {colors.map(c => <ManaSymbol key={c} color={c} size={22} />)}
          </div>
        );
      };

      return (
        <div style={{ padding: '20px' }}>
          <div style={{ maxWidth: '900px', margin: '0 auto' }}>
            {/* Header */}
            <header style={{ textAlign: 'center', marginBottom: '30px' }}>
              <h1 style={{
                fontSize: '3rem',
                fontWeight: 'normal',
                letterSpacing: '0.15em',
                textTransform: 'uppercase',
                margin: 0,
                textShadow: '0 2px 20px rgba(180, 150, 100, 0.3)',
                background: 'linear-gradient(180deg, #D4C4A8 0%, #8B7355 100%)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
              }}>
                Spelldle
              </h1>
              <p style={{ 
                opacity: 0.7, 
                fontStyle: 'italic',
                margin: '8px 0 0 0',
                fontSize: '1.1rem',
              }}>
                Divine the card in 6 guesses
              </p>
            </header>

            {/* Game Status */}
            {gameOver && (
              <div style={{
                textAlign: 'center',
                padding: '24px',
                marginBottom: '20px',
                backgroundColor: won ? 'rgba(45, 90, 39, 0.3)' : 'rgba(74, 44, 44, 0.3)',
                border: `2px solid ${won ? '#4A9C3D' : '#6B3D3D'}`,
                borderRadius: '8px',
              }}>
                {won ? (
                  <div>
                    <div style={{ fontSize: '1.5rem', marginBottom: '8px' }}>✨ Divination Successful! ✨</div>
                    <div style={{ marginBottom: '16px' }}>You found <strong>{targetCard.name}</strong> in {guesses.length} {guesses.length === 1 ? 'guess' : 'guesses'}!</div>
                  </div>
                ) : (
                  <div>
                    <div style={{ fontSize: '1.5rem', marginBottom: '8px' }}>The spirits elude you...</div>
                    <div style={{ marginBottom: '16px' }}>The card was <strong>{targetCard.name}</strong></div>
                  </div>
                )}
                <div style={{
                  display: 'flex',
                  justifyContent: 'center',
                  perspective: '1000px',
                }}>
                  <img
                    src={`https://api.scryfall.com/cards/named?exact=${encodeURIComponent(targetCard.name)}&format=image`}
                    alt={targetCard.name}
                    style={{
                      width: '250px',
                      borderRadius: '12px',
                      boxShadow: '0 8px 32px rgba(0, 0, 0, 0.5), 0 0 60px rgba(180, 150, 100, 0.2)',
                      animation: 'cardReveal 0.6s ease-out',
                    }}
                  />
                </div>
              </div>
            )}

            {/* Input */}
            {!gameOver && (
              <div style={{ position: 'relative', marginBottom: '20px' }}>
                <input
                  type="text"
                  value={input}
                  onChange={(e) => handleInputChange(e.target.value)}
                  placeholder="Enter a card name..."
                  style={{
                    width: '100%',
                    padding: '16px 20px',
                    fontSize: '1.1rem',
                    backgroundColor: 'rgba(40, 35, 50, 0.8)',
                    border: '2px solid rgba(180, 150, 100, 0.3)',
                    borderRadius: '8px',
                    color: '#E8E4D9',
                    fontFamily: 'inherit',
                    outline: 'none',
                  }}
                />
                {suggestions.length > 0 && (
                  <div style={{
                    position: 'absolute',
                    top: '100%',
                    left: 0,
                    right: 0,
                    backgroundColor: 'rgba(40, 35, 50, 0.98)',
                    border: '2px solid rgba(180, 150, 100, 0.3)',
                    borderTop: 'none',
                    borderRadius: '0 0 8px 8px',
                    zIndex: 100,
                    maxHeight: '250px',
                    overflowY: 'auto',
                  }}>
                    {suggestions.map(card => (
                      <div
                        key={card.name}
                        onClick={() => submitGuess(card)}
                        style={{
                          padding: '12px 20px',
                          cursor: 'pointer',
                          borderBottom: '1px solid rgba(180, 150, 100, 0.1)',
                          transition: 'background 0.15s',
                        }}
                        onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'rgba(180, 150, 100, 0.15)'}
                        onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'transparent'}
                      >
                        <span style={{ fontWeight: 500 }}>{card.name}</span>
                        <span style={{ opacity: 0.6, marginLeft: '12px', fontSize: '0.9rem' }}>
                          {card.type} • {card.colors.length > 0 ? card.colors.join('') : 'C'}
                        </span>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {/* Hint */}
            {!gameOver && guesses.length >= 3 && (
              <div style={{ textAlign: 'center', marginBottom: '20px' }}>
                <button
                  onClick={() => setShowHint(!showHint)}
                  style={{
                    background: 'none',
                    border: '1px solid rgba(180, 150, 100, 0.4)',
                    color: '#B4966E',
                    padding: '8px 16px',
                    borderRadius: '4px',
                    cursor: 'pointer',
                    fontFamily: 'inherit',
                    fontSize: '0.9rem',
                  }}
                >
                  {showHint ? 'Hide Hint' : 'Reveal Hint'}
                </button>
                {showHint && (
                  <p style={{ marginTop: '10px', opacity: 0.8, fontStyle: 'italic' }}>
                    First letter: {targetCard.name[0]}
                  </p>
                )}
              </div>
            )}

            {/* Guesses */}
            {guesses.length > 0 && (
              <div>
                {/* Header Row */}
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: '1.8fr 1fr 0.7fr 1fr 0.8fr 0.7fr 0.6fr 0.6fr',
                  gap: '8px',
                  padding: '10px 0',
                  borderBottom: '1px solid rgba(180, 150, 100, 0.2)',
                  marginBottom: '10px',
                  fontSize: '0.85rem',
                  textTransform: 'uppercase',
                  letterSpacing: '0.1em',
                  opacity: 0.7,
                }}>
                  <div>Card</div>
                  <div style={{ textAlign: 'center' }}>Colors</div>
                  <div style={{ textAlign: 'center' }}>CMC</div>
                  <div style={{ textAlign: 'center' }}>Type</div>
                  <div style={{ textAlign: 'center' }}>Rarity</div>
                  <div style={{ textAlign: 'center' }}>Year</div>
                  <div style={{ textAlign: 'center' }}>P</div>
                  <div style={{ textAlign: 'center' }}>T</div>
                </div>

                {/* Guess Rows */}
                {guesses.map((guess, i) => {
                  const colorResult = compareColors(guess.colors, targetCard.colors);
                  const cmcResult = compareValue(guess.cmc, targetCard.cmc);
                  const typeResult = guess.type === targetCard.type ? 'correct' : 'wrong';
                  const rarityResult = guess.rarity === targetCard.rarity ? 'correct' : 'wrong';
                  const yearResult = compareValue(guess.year, targetCard.year);
                  const powerResult = (guess.power === null && targetCard.power === null) ? 'correct' : compareValue(guess.power, targetCard.power);
                  const toughnessResult = (guess.toughness === null && targetCard.toughness === null) ? 'correct' : compareValue(guess.toughness, targetCard.toughness);
                  
                  return (
                    <div
                      key={i}
                      style={{
                        display: 'grid',
                        gridTemplateColumns: '1.8fr 1fr 0.7fr 1fr 0.8fr 0.7fr 0.6fr 0.6fr',
                        gap: '8px',
                        marginBottom: '8px',
                        animation: 'fadeIn 0.3s ease',
                      }}
                    >
                      <div style={{
                        padding: '10px 12px',
                        backgroundColor: 'rgba(40, 35, 50, 0.6)',
                        borderRadius: '6px',
                        display: 'flex',
                        alignItems: 'center',
                        fontWeight: 500,
                      }}>
                        {guess.name}
                      </div>
                      <CompareIndicator result={colorResult}>
                        {formatColors(guess.colors)}
                      </CompareIndicator>
                      <CompareIndicator result={cmcResult}>
                        {guess.cmc}
                      </CompareIndicator>
                      <CompareIndicator result={typeResult}>
                        <span style={{ fontSize: '0.85rem' }}>{guess.type}</span>
                      </CompareIndicator>
                      <CompareIndicator result={rarityResult}>
                        <span style={{ fontSize: '0.8rem', textTransform: 'capitalize' }}>{guess.rarity}</span>
                      </CompareIndicator>
                      <CompareIndicator result={yearResult}>
                        {guess.year}
                      </CompareIndicator>
                      <CompareIndicator result={powerResult}>
                        {guess.power ?? '—'}
                      </CompareIndicator>
                      <CompareIndicator result={toughnessResult}>
                        {guess.toughness ?? '—'}
                      </CompareIndicator>
                    </div>
                  );
                })}
              </div>
            )}

            {/* Legend */}
            <div style={{
              marginTop: '30px',
              padding: '20px',
              backgroundColor: 'rgba(40, 35, 50, 0.4)',
              borderRadius: '8px',
              fontSize: '0.9rem',
            }}>
              <div style={{ fontWeight: 500, marginBottom: '12px', opacity: 0.8 }}>How to read the clues:</div>
              <div style={{ display: 'flex', flexWrap: 'wrap', gap: '20px' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                  <div style={{ width: '20px', height: '20px', backgroundColor: '#2D5A27', border: '2px solid #4A9C3D', borderRadius: '4px' }} />
                  <span>Exact match</span>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                  <div style={{ width: '20px', height: '20px', backgroundColor: '#8B6914', border: '2px solid #D4A82B', borderRadius: '4px' }} />
                  <span>Partial (some colors match)</span>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                  <div style={{ width: '20px', height: '20px', backgroundColor: '#4A2C2C', border: '2px solid #6B3D3D', borderRadius: '4px' }} />
                  <span>No match</span>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                  <span>↑↓</span>
                  <span>Target is higher/lower</span>
                </div>
              </div>
            </div>

            {/* Footer */}
            <div style={{ 
              textAlign: 'center', 
              marginTop: '30px', 
              opacity: 0.5,
              fontSize: '0.85rem',
            }}>
              {cardPool.length} cards in pool • New card daily at midnight
            </div>
          </div>
        </div>
      );
    }

    // App wrapper that handles loading
    function App() {
      const [cardPool, setCardPool] = useState(null);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      useEffect(() => {
        // Check if cards are defined directly
        if (window.CARD_POOL) {
          setCardPool(window.CARD_POOL);
          setLoading(false);
          return;
        }

        // Otherwise load from URL
        const url = window.CARD_POOL_URL || 'card-pool.json';
        
        fetch(url)
          .then(res => {
            if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);
            return res.json();
          })
          .then(data => {
            if (!Array.isArray(data) || data.length === 0) {
              throw new Error('Card pool must be a non-empty array');
            }
            setCardPool(data);
            setLoading(false);
          })
          .catch(err => {
            setError(err.message);
            setLoading(false);
          });
      }, []);

      if (loading) return <LoadingScreen />;
      if (error) return <ErrorScreen error={error} />;
      return <Game cardPool={cardPool} />;
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
